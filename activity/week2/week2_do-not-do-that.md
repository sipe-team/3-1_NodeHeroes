# 어떤 패키지?

- TypeORM과 Prisma 스키마 또는 엔티티 파일을 읽어, 그 구조에 맞는 모의 데이터를 자동으로 생성하는 패키지

# 이거 왜 씀?

- 데이터베이스 테스트나 시뮬레이션을 위해 대규모 모의 데이터를 필요로 하는 경우 필요함.
- 수동으로 테스트 데이터 생성하기 귀찮음. 딸깍 한번으로 하고 싶음.
- 🚨 내가 회사에서 필요함.
  - 프로젝트마다 다르긴한데, orm 이 뒤섞여있음.
  - 여러 데이터를 한번에 업데이트 할때의 성능이나 부하를 확인해보고 싶은데, 실제 데이터 넣기에는 위험한 데이터도 있음
  - 매번 db에서 데이터 가져와서 부어넣기 귀찮음.
  - 그렇다고 아무런 의미 없는 데이터를 넣을 순 없음. transform 단계에서 validation 이나 여러 비즈니스 조건 별 데이터 가공되는 것을 보고 싶음.

# 대체제는?

- [typeorm-seeding](https://www.npmjs.com/package/typeorm-seeding)
  - 별 890개의 3년전 커밋이 마지막인 레포.
  - typeorm 전용임. typeorm에서 사용하는 ormconfig.js 나 env 파일 내에서 시드와 팩토리 코드의 경로를 넣고, 해당 시드를 실행시키는 것으로 동작함.
- [prisma 내부의 seed 기능](https://www.prisma.io/docs/orm/prisma-migrate/workflows/seeding)
  - prisma 내부에 지원하고 있음.
  - 데이터가 자동으로 생성되는 것은 아니고, 유저가 직접 어떤 데이터를 넣을지 미리 설정해두는 것임.
  - 내 불편함을 전혀 해소해주지 못함.
- faker.js
  - 문제가ㅋㅋㅋㅋ 많았던 라이브러리.
  - 아무튼 대체제가 생겼고, 지금도 꾸준히 사람들이 다운로드 받고 있지만 “랜덤한 데이터 생성기” 정도의 포지션으로, db 에 들어가게 하려면 개발자가 직접 faker.js 를 이용해서 스크립트 작성 후 실행시켜야함. 자신의 엔티티(혹은 스키마) 파일에 맞게.

# 구체적으로 어떻게 구현?

## 1. TypeORM & Prisma 메타데이터 파싱

- TypeORM 에서는 getMetadata 메서드를 통해 엔티티의 필드 정보를 가져올 수 있음.
  - 이를 통해 필드 이름, 타입, 관계 등의 메타데이터를 추출하고, 각 필드 타입에 맞는 무작위 데이터를 생성할 수 있음.
- Prisma 에서는 Prisma 스키마 파일을 직접 파싱하거나 Prisma 의 CLI 명령을 통해 생성된 메타데이터를 활용할 수 있음.
  - Prisma 스키마 파일은 .prisma 파일로 정의되어 있으며, @prisma/client 패키지를 통해 스키마 구조에 접근할 수 있음.

## 2. 필드 타입에 따른 모의 데이터 생성

- 필드 타입에 따라 데이터를 자동으로 생성하려면, 각 필드 타입에 적절한 모의 데이터를 매핑할 수 있어야함.

## 3. 관계형 데이터베이스의 관계 처리

- TypeORM과 Prisma 는 관계형 데이터베이스의 다양한 관계 설정(1대1, 1대다, 다대다)을 지원하므로, 관계형 데이터를 자동생성할 때도 이를 고려해 모의 데이터를 생성할 수 있어야함.
- 예를 들어, User와 Profile 엔티티가 1:1 관계일 경우, User 생성 시 자동으로 Profile 모의 데이터도 함께 생성하는 방식으로 설계할 수 있음.
  - 이 작업은 고도화 작업 시 같이 진행될 예정.
